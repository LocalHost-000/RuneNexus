{%  extends 'layout.twig' %}

{% block content %}

<div class="card border-0 shadow-sm overflow-hidden mb-2">
    <div class="text-white bg-primary card-header py-3">
        <div class="row align-items-center">
            <div class="col">
                RuneAd Full Server List |  Currently tracking <strong class="text-success">{{ server_count }}</strong> servers!
            </div>
            <div class="col text-right text-muted">
                <small>Panel Last updated: 12/17/2020</small>
            </div>
        </div>
    </div>

    {% set start_rank = servers.firstItem() %}

    <table class="table mb-0" style="line-height:1em;">
        <thead class="thead-{{ theme }}">
            <tr>
                <th class="text-left py-2 small border-0">Server</th>
                <th class="text-left py-2 small border-0">Status</th>
                <th class="text-left py-2 small border-0">Creation Date</th>
                <th class="text-left py-2 small border-0">Votes</th>
                <th class="text-left py-2 small border-0">Premium Info</th>
                <th class="text-left py-2 small border-0">Premium Trial</th>
            </tr>
        </thead>

        {% for server in servers.items() %}
        {% set server_url = friendlyTitle(server.id~' '~server.title) %}

        {% set isPremium = server.premium_expires > time() %}
        {% set class = isPremium ? 'bg-premium' : '' %}
        
        <tr id="server" class="{{ class }}">

            <td class="py-2">{{ start_rank }})
                <a href="{{ url('details/'~server_url) }}">
                    {% if server.title|length > 40 %}
                    {{ substr(server.title, 0, 40)~'...' }}
                    {% else %}
                    {{ server.title }}
                    {% endif %}
                </a>
            </td>

             <td class="small pr-1">
                {% if server.ping == -1  %}
                <span class="badge badge-danger status-badge small"
                    data-toggle="tooltip" data-title="{{ elapsed(server.last_ping) }}">
                    Offline
                </span>
                {% else %}
                <span class="badge badge-success status-badge" 
                    data-toggle="tooltip" data-title="{{ elapsed(server.last_ping) }}">
                    Online
                </span>
                {% endif %}
            </td>

            <td>
                <p class="mb-0 text-default">
                    {{ server.date_created|date("m.d.y") }}
                </p>
            </td>

            <td>
                <p class="mb-0" id="votes">{{ server.votes|number_format }}</p>
            </td>

            <td>
                <p class="mb-0 text-default">
                    {% if server.premium_expires > time() %}
                        <span class="text-success">
                            {{ timeLeft(server.premium_expires, true)}}
                        </span>
                    {% elseif server.premium_expires < time() and server.premium_expires != -1 %}
                        <span class="text-danger">
                            Expired
                        </span>
                    {% else %}
                        n/a
                    {% endif %}
                </p>
            </td>

            <td>
                <a class="btn btn-info disabled" href="#"
                data-toggle="tooltip"
                data-title="Only give this per request to a new server!"
                 role="button">Give 7 days Premium</a>
            </td>


        </tr>
        {% set start_rank = start_rank + 1 %}
        {% else %}
        <tr>
            <td colspan=5 class="p-4">Uh oh! No servers found on this page. Please contact Aaron!</td>
        </tr>
        {% endfor %}
    </table>
</div>

{%  endblock %}